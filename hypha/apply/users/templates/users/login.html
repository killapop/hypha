{% extends 'base.html' %}
{% load i18n two_factor wagtailcore_tags %}
{% block header_modifier %}header--light-bg{% endblock %}
{% block title %}Login{% endblock %}

{% block content %}
<div class="wrapper wrapper--small">
    <div class="admin-bar">
        <div class="admin-bar__inner">
            <h1 class="gamma">
                {% block page_title %}Login{% endblock %}
            </h1>
            {% if wizard.steps.current == 'auth' %}
            <h5>{% blocktrans %}Enter your credentials.{% endblocktrans %}</h5>
            {% elif wizard.steps.current == 'token' %}
              {% if device.method == 'call' %}
                <h5>
                    {% blocktrans %}We are calling your phone right now, please
                    enter the digits you hear.{% endblocktrans %}
                </h5>
              {% elif device.method == 'sms' %}
                <h5>
                    {% blocktrans %}We sent you a text message, please enter the
                    tokens we sent.{% endblocktrans %}
                </h5>
              {% else %}
                <h5>
                    {% blocktrans %}Please enter the tokens generated by your token
                    generator.{% endblocktrans %}
                </h5>
              {% endif %}
            {% elif wizard.steps.current == 'backup' %}
              <h5>
                  {% blocktrans %}Use this form for entering backup tokens for
                  logging in. These tokens have been generated for you to print
                  and keep safe. Please enter one of these backup tokens to login
                  to your account.{% endblocktrans %}
              </h5>
            {% endif %}
        </div>
    </div>

    <form class="form form--with-p-tags form--user-login" method="post">
        {% csrf_token %} {{ wizard.management_form }}
        {% if wizard.steps.current == 'auth' %}
          {% for field in form %}
            {% include "forms/includes/field.html" %}
          {% endfor %}
          {{ form.extra_text|richtext }}
          <p>
              <a class="link link--small" href="{% url 'users:password_reset' %}"
                  >Forgot your password?</a
              >
          </p>
          <button class="link link--button-secondary" type="submit">Login</button>
        {% else %}
          {{ wizard.form }}
          {# hidden submit button to enable [enter] key #}
          <div style="margin-left: -9999px"><input type="submit" value="" /></div>

            {% if other_devices %}
              <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
              <p>
                  {% for other in other_devices %}
                  <button
                      name="challenge_device"
                      value="{{ other.persistent_id }}"
                      class="btn btn-default btn-block"
                      type="submit"
                  >
                      {{ other|device_action }}
                  </button>
                  {% endfor %}
                </p>
              {% endif %}

              {% if backup_tokens %}
                <p>{% trans "As a last resort, you can use a backup token:" %}</p>
                <p>
                  <button
                      name="wizard_goto_step"
                      type="submit"
                      value="backup"
                      class="btn btn-default btn-block"
                  >
                  {% trans "Use Backup Token" %}
                  </button>
                </p>
              {% endif %}

              <div class="wrapper wrapper--inner-space-large">
                  {% include "two_factor/_wizard_actions.html" %}
              </div>
            {% endif %}
      </form>

    <!-- {% if wizard.steps.current == 'auth' %}
        <div class="wrapper wrapper--inner-space-large">
          <a class="link link--button link--button-long-text" href="{% url "social:begin" "google-oauth2" %}{% if next %}?next={{ next }}{% endif %}">Log in with your {{ ORG_SHORT_NAME }} email</a>
        </div>
    {% endif %} -->
</div>
{% endblock %}
